name: üîê WINCOVA Security Audit Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]
  workflow_dispatch:

env:
  NODE_VERSION: '18'

jobs:
  # ============================================
  # FASE 1: Code Quality & Type Safety
  # ============================================
  code-quality:
    name: üìã Code Quality Analysis
    runs-on: ubuntu-latest
    steps:
      - name: üîç Checkout code
        uses: actions/checkout@v4

      - name: üì¶ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: üì• Install dependencies
        run: npm ci

      - name: üîé Run ESLint
        run: npm run lint || echo "::warning::Linting issues found"
        continue-on-error: true

      - name: üîç TypeScript Type Check
        run: npx tsc --noEmit

      - name: üìä Upload ESLint results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: eslint-results
          path: eslint-report.json
          retention-days: 30

  # ============================================
  # FASE 2: Automated Testing
  # ============================================
  testing:
    name: üß™ Automated Tests
    runs-on: ubuntu-latest
    steps:
      - name: üîç Checkout code
        uses: actions/checkout@v4

      - name: üì¶ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: üì• Install dependencies
        run: npm ci

      - name: üß™ Run Tests with Coverage
        run: npm run test || echo "::warning::Some tests failed"
        continue-on-error: true

      - name: üìä Generate Test Report
        if: always()
        run: |
          echo "## Test Results" >> $GITHUB_STEP_SUMMARY
          echo "Tests executed at $(date)" >> $GITHUB_STEP_SUMMARY

      - name: üìà Upload Coverage
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: coverage-report
          path: coverage/
          retention-days: 30

  # ============================================
  # FASE 3: Security Scanning
  # ============================================
  security:
    name: üõ°Ô∏è Security Analysis
    runs-on: ubuntu-latest
    steps:
      - name: üîç Checkout code
        uses: actions/checkout@v4

      - name: üì¶ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: üì• Install dependencies
        run: npm ci

      - name: üîê Run npm audit
        run: |
          npm audit --json > audit-report.json || true
          echo "## Security Audit" >> $GITHUB_STEP_SUMMARY
          npm audit || echo "::warning::Security vulnerabilities found"
        continue-on-error: true

      - name: üìä Upload Audit Report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: security-audit
          path: audit-report.json
          retention-days: 30

      - name: üîç Check for hardcoded secrets
        run: |
          echo "Scanning for hardcoded secrets..."
          if grep -r "sk_live_" src/ 2>/dev/null; then
            echo "::error::Found potential Stripe live keys!"
            exit 1
          fi
          if grep -r "password.*=.*['\"]" src/ 2>/dev/null | grep -v "placeholder"; then
            echo "::warning::Found potential hardcoded passwords"
          fi
          echo "‚úÖ No obvious hardcoded secrets found"

  # ============================================
  # FASE 4: AI Security Analysis with WINCOVA Bot
  # ============================================
  security-analysis:
    name: ü§ñ OpenAI Code Analysis
    runs-on: ubuntu-latest
    needs: [code-quality, testing, security]
    if: always()
    steps:
      - name: üîç Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: üìä Get commit changes
        id: get-diff
        run: |
          echo "Getting diff for commit ${{ github.sha }}"
          git diff HEAD^ HEAD > changes.diff
          
          # Get list of changed files
          CHANGED_FILES=$(git diff --name-only HEAD^ HEAD | tr '\n' ',' | sed 's/,$//')
          echo "changed_files=$CHANGED_FILES" >> $GITHUB_OUTPUT
          
          # Check if diff is too large (max 100KB for API)
          DIFF_SIZE=$(wc -c < changes.diff)
          echo "Diff size: $DIFF_SIZE bytes"
          
          if [ $DIFF_SIZE -gt 100000 ]; then
            echo "‚ö†Ô∏è Diff too large, truncating..."
            head -c 100000 changes.diff > changes_truncated.diff
            mv changes_truncated.diff changes.diff
          fi

      - name: ü§ñ WINCOVA Security Auditor v2.0
        id: ai-analysis
        continue-on-error: true
        run: |
          echo "ü§ñ Iniciando WINCOVA Security Auditor v2.0..."
          echo "üìä Modelo: GPT-5 | Temperatura: 0.2 | Max Tokens: 4000"
          
          # Read diff content
          DIFF_CONTENT=$(cat changes.diff | jq -Rs .)
          CHANGED_FILES="${{ steps.get-diff.outputs.changed_files }}"
          
          # Create advanced system prompt
          SYSTEM_PROMPT="# WINCOVA Security Auditor v2.0

## Identidad
Eres el **WINCOVA Security Auditor**, un agente especializado en auditor√≠a de c√≥digo para aplicaciones web modernas. Tu misi√≥n es garantizar c√≥digo seguro, performante y mantenible.

## Stack Tecnol√≥gico del Proyecto
- **Frontend**: React 18 + TypeScript + Vite + Tailwind CSS
- **Backend**: Supabase (PostgreSQL + Edge Functions)
- **Auth**: Supabase Auth con RLS (Row Level Security)
- **Deploy**: GitHub Actions CI/CD
- **Patrones**: Hooks, Context API, React Query, shadcn/ui

## Capas de An√°lisis

### üîê CRITICAL - Seguridad (M√°xima Prioridad)
- Credenciales hardcodeadas o secrets expuestos
- Vulnerabilidades OWASP Top 10 (SQLi, XSS, CSRF, etc.)
- Fallos en autenticaci√≥n/autorizaci√≥n
- Bypass de RLS policies en Supabase
- Datos sensibles sin encriptar
- API endpoints sin rate limiting
- CORS mal configurado

### ‚ö° IMPORTANT - Performance & Calidad
- Memory leaks (useEffect sin cleanup)
- Re-renders innecesarios (falta React.memo, useMemo)
- Queries N+1 en base de datos
- Im√°genes sin optimizar (falta lazy loading)
- Bundles pesados (imports innecesarios)
- C√≥digo duplicado que debe refactorizarse
- Violaciones de principios SOLID

### üé® SUGGESTION - UX & Mejoras
- Accesibilidad WCAG 2.1 (alt text, aria-labels)
- Estados de loading/error faltantes
- Responsive design issues
- C√≥digo legacy que puede modernizarse
- Mejores nombres de variables/funciones
- Comentarios/documentaci√≥n faltantes

## Formato de Respuesta

Responde √öNICAMENTE con JSON v√°lido (sin markdown, sin texto adicional):

{
  \"agent\": \"WINCOVA Security Auditor v2.0\",
  \"model\": \"gpt-5\",
  \"timestamp\": \"ISO-8601\",
  \"summary\": {
    \"critical_count\": 0,
    \"important_count\": 0,
    \"suggestion_count\": 0,
    \"overall_risk\": \"low|medium|high|critical\"
  },
  \"corrections\": [
    {
      \"severity\": \"critical|important|suggestion\",
      \"category\": \"security|performance|architecture|ux|accessibility\",
      \"file\": \"ruta/completa/archivo.tsx\",
      \"line\": 123,
      \"title\": \"T√≠tulo conciso (max 60 chars)\",
      \"description\": \"Descripci√≥n t√©cnica detallada con impacto y soluci√≥n (max 300 chars)\",
      \"code_before\": \"c√≥digo problem√°tico actual\",
      \"code_after\": \"c√≥digo corregido sugerido\",
      \"references\": [\"https://owasp.org/...\", \"https://react.dev/...\"],
      \"impact\": \"Descripci√≥n del impacto en producci√≥n\"
    }
  ]
}

## Priorizaci√≥n
1. **CRITICAL**: Fix inmediato requerido
2. **IMPORTANT**: Fix en pr√≥ximo sprint
3. **SUGGESTION**: Considerar para refactoring futuro

## Restricciones
- NO sugieras cambios en node_modules/
- NO sugieras cambios en archivos generados (.d.ts, build/)
- Enf√≥cate en cambios del diff, no en todo el proyecto
- S√© espec√≠fico: l√≠nea exacta, c√≥digo exacto
- C√≥digo sugerido debe ser funcional y testeable"

          # Create OpenAI request with retry logic
          MAX_RETRIES=3
          RETRY_COUNT=0
          SUCCESS=false
          
          while [ $RETRY_COUNT -lt $MAX_RETRIES ] && [ "$SUCCESS" = false ]; do
            echo "üîÑ Intento $((RETRY_COUNT + 1)) de $MAX_RETRIES..."
            
            RESPONSE=$(curl -s https://api.openai.com/v1/chat/completions \
              -H "Authorization: Bearer ${{ secrets.OPENAI_API_KEY }}" \
              -H "Content-Type: application/json" \
              -d "{
                \"model\": \"gpt-5\",
                \"messages\": [
                  {
                    \"role\": \"system\",
                    \"content\": $(echo "$SYSTEM_PROMPT" | jq -Rs .)
                  },
                  {
                    \"role\": \"user\",
                    \"content\": \"Analiza estos cambios:\n\n## Archivos Modificados\n${CHANGED_FILES}\n\n## Git Diff\n${DIFF_CONTENT}\"
                  }
                ],
                \"temperature\": 0.2,
                \"max_completion_tokens\": 4000
              }")
            
            # Check for API errors
            if echo "$RESPONSE" | jq -e '.error' > /dev/null; then
              ERROR_MSG=$(echo "$RESPONSE" | jq -r '.error.message')
              ERROR_TYPE=$(echo "$RESPONSE" | jq -r '.error.type')
              echo "::warning::OpenAI API Error (Attempt $((RETRY_COUNT + 1))): $ERROR_TYPE - $ERROR_MSG"
              
              # Exponential backoff
              SLEEP_TIME=$((2 ** RETRY_COUNT))
              echo "‚è≥ Esperando ${SLEEP_TIME}s antes de reintentar..."
              sleep $SLEEP_TIME
              
              RETRY_COUNT=$((RETRY_COUNT + 1))
            else
              SUCCESS=true
              echo "‚úÖ An√°lisis completado exitosamente"
            fi
          done
          
          if [ "$SUCCESS" = false ]; then
            echo "::error::Failed to get AI analysis after $MAX_RETRIES attempts"
            echo "ai_analysis={\"error\": \"Max retries exceeded\", \"corrections\": []}" >> $GITHUB_OUTPUT
            exit 0
          fi
          
          # Extract and validate AI response
          AI_ANALYSIS=$(echo "$RESPONSE" | jq -r '.choices[0].message.content')
          
          # Remove markdown code blocks if present
          AI_ANALYSIS=$(echo "$AI_ANALYSIS" | sed 's/^```json//g' | sed 's/^```//g' | sed 's/```$//g')
          
          # Validate JSON
          if echo "$AI_ANALYSIS" | jq empty 2>/dev/null; then
            echo "‚úÖ JSON v√°lido recibido"
            
            # Extract summary
            CRITICAL_COUNT=$(echo "$AI_ANALYSIS" | jq -r '.summary.critical_count // 0')
            IMPORTANT_COUNT=$(echo "$AI_ANALYSIS" | jq -r '.summary.important_count // 0')
            SUGGESTION_COUNT=$(echo "$AI_ANALYSIS" | jq -r '.summary.suggestion_count // 0')
            OVERALL_RISK=$(echo "$AI_ANALYSIS" | jq -r '.summary.overall_risk // "unknown"')
            
            echo "üìä Resumen del An√°lisis:"
            echo "  üî¥ Cr√≠ticos: $CRITICAL_COUNT"
            echo "  üü° Importantes: $IMPORTANT_COUNT"
            echo "  üü¢ Sugerencias: $SUGGESTION_COUNT"
            echo "  ‚ö†Ô∏è Riesgo General: $OVERALL_RISK"
            
            # Set GitHub output
            echo "ai_analysis<<EOF" >> $GITHUB_OUTPUT
            echo "$AI_ANALYSIS" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
            
            # Create annotation for critical issues
            if [ "$CRITICAL_COUNT" -gt 0 ]; then
              echo "::error::üö® Se encontraron $CRITICAL_COUNT problemas CR√çTICOS de seguridad"
            fi
          else
            echo "::warning::Respuesta de OpenAI no es JSON v√°lido"
            echo "ai_analysis={\"error\": \"Invalid JSON response\", \"corrections\": [], \"raw_response\": $(echo "$AI_ANALYSIS" | jq -Rs .)}" >> $GITHUB_OUTPUT
          fi

      - name: üì§ Upload AI Analysis
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ai-analysis
          path: changes.diff
          retention-days: 30

  # ============================================
  # FASE 5: AI UX Analysis with Ultra UX Bot
  # ============================================
  ux-analysis:
    name: üé® AI UX Analysis (Ultra UX Bot v2.0)
    runs-on: ubuntu-latest
    needs: [code-quality, testing]
    # Only run if frontend files changed
    if: contains(github.event.head_commit.modified, 'src/') || contains(github.event.head_commit.modified, 'components/')
    steps:
      - name: üîç Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 2

      - name: üì¶ Get changed files
        id: changed-files
        run: |
          echo "files=$(git diff --name-only HEAD^..HEAD | grep -E '^(src/|components/)' | tr '\n' ' ')" >> $GITHUB_OUTPUT

      - name: ü§ñ Run Ultra UX Analysis
        id: ux-analysis
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          # Get the diff for changed files
          DIFF=$(git diff HEAD^..HEAD -- src/ components/ 2>/dev/null || echo "No frontend changes")
          
          # Prepare prompt for Ultra UX Bot
          PROMPT="You are Ultra UX & Frontline Validation Bot v2.0. Analyze this frontend code change for UX issues.

          ANALYZE FOR:
          1. UX Blockers (CRITICAL): Non-functional buttons, broken flows, touch targets < 44px
          2. UX Friction (IMPORTANT): Missing loading states, poor error messages, dead clicks
          3. UX Enhancement (SUGGESTION): Animation improvements, better micro-copy

          CALCULATE ROI for each issue:
          - Traffic affected %
          - Conversion impact
          - Revenue at risk ($/day)

          Changed files: ${{ steps.changed-files.outputs.files }}

          Git diff:
          \`\`\`
          $DIFF
          \`\`\`

          Respond ONLY with valid JSON following the Ultra UX Bot v2.0 schema."

          # Call OpenAI API
          RESPONSE=$(curl -s https://api.openai.com/v1/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $OPENAI_API_KEY" \
            -d "{
              \"model\": \"gpt-5\",
              \"messages\": [
                {
                  \"role\": \"system\",
                  \"content\": \"You are Ultra UX & Frontline Validation Bot v2.0, a senior UX auditor focused on emotional UX, ROI, and multi-platform validation. You detect invisible frictions, calculate revenue impact, and ensure Amazon-level user experience. Temperature: 0.3\"
                },
                {
                  \"role\": \"user\",
                  \"content\": $(echo "$PROMPT" | jq -Rs .)
                }
              ],
              \"max_completion_tokens\": 4000
            }")

          # Extract the AI response
          AI_CONTENT=$(echo "$RESPONSE" | jq -r '.choices[0].message.content' 2>/dev/null || echo '{"error": "Failed to parse OpenAI response"}')

          # Validate JSON
          if echo "$AI_CONTENT" | jq empty 2>/dev/null; then
            echo "‚úÖ Ultra UX Bot v2.0 analysis completed"
            echo "$AI_CONTENT" | jq '.'
            
            # Save to file for reporting
            echo "$AI_CONTENT" > ux-analysis.json
            
            # Extract summary
            CRITICAL=$(echo "$AI_CONTENT" | jq -r '.summary.critical_count // 0')
            IMPORTANT=$(echo "$AI_CONTENT" | jq -r '.summary.important_count // 0')
            REVENUE_RISK=$(echo "$AI_CONTENT" | jq -r '.summary.revenue_at_risk_daily // 0')
            
            echo "## üé® Ultra UX Bot v2.0 Analysis" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "üî¥ **Critical UX Blockers:** $CRITICAL" >> $GITHUB_STEP_SUMMARY
            echo "üü° **UX Friction Issues:** $IMPORTANT" >> $GITHUB_STEP_SUMMARY
            echo "üí∞ **Revenue at Risk:** \$$REVENUE_RISK/day" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            
            # Set output for next jobs
            echo "ux_analysis=$AI_CONTENT" >> $GITHUB_OUTPUT
            echo "critical_count=$CRITICAL" >> $GITHUB_OUTPUT
          else
            echo "‚ö†Ô∏è Ultra UX Bot returned invalid JSON"
            echo '{"agent": "Ultra UX Bot v2.0", "error": "Invalid JSON response", "summary": {"critical_count": 0, "important_count": 0}}' > ux-analysis.json
            echo "ux_analysis={\"error\": \"Invalid response\"}" >> $GITHUB_OUTPUT
            echo "critical_count=0" >> $GITHUB_OUTPUT
          fi

      - name: üìä Upload UX Analysis
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: ux-analysis
          path: ux-analysis.json
          retention-days: 30

  # ============================================
  # FASE 6: Build Verification
  # ============================================
  build:
    name: üèóÔ∏è Build Verification
    runs-on: ubuntu-latest
    needs: [code-quality, testing]
    steps:
      - name: üîç Checkout code
        uses: actions/checkout@v4

      - name: üì¶ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'

      - name: üì• Install dependencies
        run: npm ci

      - name: üèóÔ∏è Build Project
        run: npm run build
        env:
          VITE_SUPABASE_URL: ${{ secrets.VITE_SUPABASE_URL || 'https://placeholder.supabase.co' }}
          VITE_SUPABASE_PUBLISHABLE_KEY: ${{ secrets.VITE_SUPABASE_PUBLISHABLE_KEY || 'placeholder-key' }}
          VITE_SUPABASE_PROJECT_ID: ${{ secrets.VITE_SUPABASE_PROJECT_ID || 'placeholder-id' }}

      - name: üìä Check Build Size
        run: |
          BUILD_SIZE=$(du -sh dist | cut -f1)
          echo "## Build Analysis" >> $GITHUB_STEP_SUMMARY
          echo "üì¶ Build size: $BUILD_SIZE" >> $GITHUB_STEP_SUMMARY
          echo "‚úÖ Build completed successfully" >> $GITHUB_STEP_SUMMARY

      - name: üì§ Upload Build Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-output
          path: dist/
          retention-days: 7

  # ============================================
  # REPORTING: Send Results to Webhook
  # ============================================
  report:
    name: üì° Report to WINCOVA Dashboard
    runs-on: ubuntu-latest
    needs: [code-quality, testing, security, security-analysis, ux-analysis, build]
    if: always()
    steps:
      - name: üìä Collect Results
        id: collect
        run: |
          echo "Collecting audit results..."
          
          # Get Security AI analysis if available
          SECURITY_ANALYSIS="${{ needs.security-analysis.outputs.ai_analysis }}"
          if [ -n "$SECURITY_ANALYSIS" ]; then
            echo "security_analysis=$SECURITY_ANALYSIS" >> $GITHUB_OUTPUT
          else
            echo "security_analysis={}" >> $GITHUB_OUTPUT
          fi
          
          # Get UX AI analysis if available
          UX_ANALYSIS="${{ needs.ux-analysis.outputs.ux_analysis }}"
          if [ -n "$UX_ANALYSIS" ]; then
            echo "ux_analysis=$UX_ANALYSIS" >> $GITHUB_OUTPUT
          else
            echo "ux_analysis={}" >> $GITHUB_OUTPUT
          fi
          
          # Determine overall status
          if [[ "${{ needs.code-quality.result }}" == "failure" ]] || \
             [[ "${{ needs.testing.result }}" == "failure" ]] || \
             [[ "${{ needs.security.result }}" == "failure" ]] || \
             [[ "${{ needs.build.result }}" == "failure" ]]; then
            echo "status=failure" >> $GITHUB_OUTPUT
            echo "conclusion=failure" >> $GITHUB_OUTPUT
          else
            echo "status=success" >> $GITHUB_OUTPUT
            echo "conclusion=success" >> $GITHUB_OUTPUT
          fi

      - name: üì° Send to Webhook
        if: always()
        run: |
          # Escape commit message for JSON
          COMMIT_MSG=$(echo "${{ github.event.head_commit.message }}" | jq -Rs .)
          
          # Escape Security AI analysis for JSON
          SECURITY_ANALYSIS='${{ steps.collect.outputs.security_analysis }}'
          if [ -z "$SECURITY_ANALYSIS" ] || [ "$SECURITY_ANALYSIS" = "{}" ]; then
            SECURITY_ANALYSIS_JSON="null"
          else
            SECURITY_ANALYSIS_JSON=$(echo "$SECURITY_ANALYSIS" | jq -Rs .)
          fi
          
          # Escape UX AI analysis for JSON
          UX_ANALYSIS='${{ steps.collect.outputs.ux_analysis }}'
          if [ -z "$UX_ANALYSIS" ] || [ "$UX_ANALYSIS" = "{}" ]; then
            UX_ANALYSIS_JSON="null"
          else
            UX_ANALYSIS_JSON=$(echo "$UX_ANALYSIS" | jq -Rs .)
          fi
          
          # Build and send payload
          curl -X POST "${{ secrets.WINCOVA_WEBHOOK_URL }}" \
            -H "Content-Type: application/json" \
            -H "X-GitHub-Event: workflow_run" \
            -d '{
              "action": "completed",
              "workflow_run": {
                "id": ${{ github.run_id }},
                "name": "${{ github.workflow }}",
                "head_branch": "${{ github.ref_name }}",
                "head_sha": "${{ github.sha }}",
                "head_commit": {
                  "message": '"${COMMIT_MSG}"'
                },
                "event": "${{ github.event_name }}",
                "status": "completed",
                "conclusion": "${{ steps.collect.outputs.conclusion }}",
                "html_url": "${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                "run_number": ${{ github.run_number }},
                "run_attempt": ${{ github.run_attempt }},
                "triggering_actor": {
                  "login": "${{ github.actor }}"
                },
                "created_at": "${{ github.event.repository.created_at }}",
                "updated_at": "${{ github.event.repository.updated_at }}",
                "security_analysis": '"${SECURITY_ANALYSIS_JSON}"',
                "ux_analysis": '"${UX_ANALYSIS_JSON}"'
              },
              "repository": {
                "full_name": "${{ github.repository }}",
                "html_url": "${{ github.server_url }}/${{ github.repository }}"
              }
            }' || echo "::warning::Failed to send webhook notification"

      - name: ‚úÖ Summary
        if: always()
        run: |
          echo "# üîê WINCOVA Audit Complete" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- **Repository:** ${{ github.repository }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch:** ${{ github.ref_name }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Commit:** ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Status:** ${{ steps.collect.outputs.status }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Run:** #${{ github.run_number }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "üìä **Results:**" >> $GITHUB_STEP_SUMMARY
          echo "- Code Quality: ${{ needs.code-quality.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Testing: ${{ needs.testing.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Security: ${{ needs.security.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Security AI Analysis: ${{ needs.security-analysis.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- UX AI Analysis: ${{ needs.ux-analysis.result }}" >> $GITHUB_STEP_SUMMARY
          echo "- Build: ${{ needs.build.result }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "üîó [View Full Report](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
